<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุณุงุช ูููุณ | SatFix App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f8fafc; }
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50 pb-20 select-none text-gray-800">

    <!-- ================= 1. ูุธุงู ุงูุญูุงูุฉ ูุชุณุฌูู ุงูุฏุฎูู ================= -->
    
    <!-- ูุงุฌูุฉ ุงูุชุฑุญูุจ ูุชุณุฌูู ุงูุฏุฎูู -->
    <div id="auth-screen" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center p-6 fade-in overflow-y-auto">
        
        <!-- ุงูููุฌู -->
        <div class="text-center mb-8">
            <div class="bg-blue-900 text-white w-20 h-20 rounded-2xl flex items-center justify-center text-4xl mx-auto shadow-xl mb-3">๐ก</div>
            <h1 class="text-3xl font-black text-blue-900">ุณุงุช ูููุณ</h1>
            <p class="text-gray-500 text-sm">ููุตุฉ ุงูููููู ูุงูุฎุฏูุงุช ุงูุฐููุฉ</p>
        </div>

        <!-- ููุฑู ุชุณุฌูู ุงูุฏุฎูู -->
        <div id="form-login" class="w-full max-w-sm space-y-4">
            <h2 class="text-xl font-bold mb-4 border-r-4 border-blue-900 pr-3">ุชุณุฌูู ุงูุฏุฎูู</h2>
            
            <div>
                <label class="text-xs font-bold text-gray-500">ุฑูู ุงููุงุชู</label>
                <input type="tel" id="login-phone" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:border-blue-500 outline-none transition" placeholder="ูุซูุงู: 0600000000">
            </div>
            <div>
                <label class="text-xs font-bold text-gray-500">ูููุฉ ุงููุฑูุฑ</label>
                <input type="password" id="login-pass" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl focus:border-blue-500 outline-none transition" placeholder="โขโขโขโขโขโข">
            </div>
            
            <button onclick="auth.login()" class="w-full bg-blue-900 text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition">ุฏุฎูู</button>
            
            <p class="text-center text-sm mt-4">
                ููุณ ูุฏูู ุญุณุงุจุ <span onclick="auth.switch('register')" class="text-blue-600 font-bold cursor-pointer">ุฃูุดุฆ ุญุณุงุจุงู ุฌุฏูุฏุงู</span>
            </p>
        </div>

        <!-- ููุฑู ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ -->
        <div id="form-register" class="w-full max-w-sm space-y-3 hidden">
            <h2 class="text-xl font-bold mb-4 border-r-4 border-green-500 pr-3">ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ</h2>
            
            <div class="grid grid-cols-2 gap-2">
                <input type="text" id="reg-name" placeholder="ุงูุงุณู ุงูุฃูู" class="w-full p-3 bg-gray-50 border rounded-xl">
                <input type="text" id="reg-lastname" placeholder="ุงููุณุจ (ุงููููุฉ)" class="w-full p-3 bg-gray-50 border rounded-xl">
            </div>
            
            <input type="tel" id="reg-phone" placeholder="ุฑูู ุงููุงุชู (ุณูููู ุงุณู ุงููุณุชุฎุฏู)" class="w-full p-3 bg-gray-50 border rounded-xl">
            <input type="email" id="reg-email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ุงุฎุชูุงุฑู)" class="w-full p-3 bg-gray-50 border rounded-xl">
            <input type="password" id="reg-pass" placeholder="ูููุฉ ุงููุฑูุฑ" class="w-full p-3 bg-gray-50 border rounded-xl">
            
            <div class="bg-blue-50 p-3 rounded-xl border border-blue-100">
                <label class="text-xs font-bold text-gray-500 block mb-2">ููุน ุงูุญุณุงุจ:</label>
                <div class="flex gap-2">
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="role" value="client" checked class="hidden peer">
                        <div class="text-center py-2 bg-white border peer-checked:bg-blue-600 peer-checked:text-white rounded-lg text-sm transition">๐ค ุฒุจูู</div>
                    </label>
                    <label class="flex-1 cursor-pointer">
                        <input type="radio" name="role" value="tech" class="hidden peer">
                        <div class="text-center py-2 bg-white border peer-checked:bg-green-600 peer-checked:text-white rounded-lg text-sm transition">๐ง ููู</div>
                    </label>
                </div>
            </div>

            <button onclick="auth.register()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold shadow-lg active:scale-95 transition">ุชุณุฌูู ุงูุญุณุงุจ</button>
            
            <p class="text-center text-sm mt-4">
                ูุฏูู ุญุณุงุจ ุจุงููุนูุ <span onclick="auth.switch('login')" class="text-blue-600 font-bold cursor-pointer">ุชุณุฌูู ุงูุฏุฎูู</span>
            </p>
        </div>

        <!-- ุฒุฑ ุงูุทูุงุฑุฆ (Admin Demo) -->
        <div class="mt-10 pt-10 border-t w-full text-center">
            <button onclick="auth.quickAdmin()" class="text-xs text-gray-300 hover:text-gray-500">ุฏุฎูู ุณุฑูุน ูู ูุฏูุฑ (Admin Demo)</button>
        </div>
    </div>


    <!-- ================= 2. ููุญุฉ ุงูุชุญูู ุงูุฑุฆูุณูุฉ (ุชุธูุฑ ุจุนุฏ ุงูุฏุฎูู) ================= -->
    <div id="main-app" class="hidden">
        
        <!-- ุงูุดุฑูุท ุงูุนููู -->
        <nav class="bg-blue-900 text-white p-4 sticky top-0 z-40 shadow-md">
            <div class="flex justify-between items-center max-w-2xl mx-auto">
                <div>
                    <h1 class="font-bold text-lg">ุณุงุช ูููุณ</h1>
                    <p id="welcome-msg" class="text-[10px] text-blue-200">ูุฑุญุจุงู</p>
                </div>
                <button onclick="auth.logout()" class="text-xs bg-red-500/20 hover:bg-red-500 text-red-100 px-3 py-1 rounded-lg border border-red-500/50 transition">
                    ุฎุฑูุฌ <i class="fas fa-sign-out-alt mr-1"></i>
                </button>
            </div>
        </nav>

        <div class="max-w-2xl mx-auto p-4 space-y-6">

            <!-- A. ูุงุฌูุฉ ุงูุฒุจูู -->
            <div id="panel-client" class="hidden fade-in">
                <!-- ุฒุฑ ุทูุจ ุงูุฎุฏูุฉ -->
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 text-center">
                    <div class="w-16 h-16 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-2xl mx-auto mb-3">๐๏ธ</div>
                    <h2 class="text-xl font-bold text-gray-800">ุงุทูุจ ููู ุงูุขู</h2>
                    <p class="text-sm text-gray-500 mb-4">ุฎุฏูุฉ ุณุฑูุนุฉ ููุถูููุฉ ูู ููุทูุชู</p>
                    <button onclick="document.getElementById('modal-service').classList.remove('hidden')" class="bg-purple-600 text-white px-8 py-3 rounded-xl font-bold shadow hover:bg-purple-700 w-full">ุทูุจ ุตูุงูุฉ</button>
                </div>

                <h3 class="font-bold text-gray-800 mt-6 mb-3">๐ ุงูููุชุฌุงุช ุงููุชุงุญุฉ</h3>
                <div id="list-client-products" class="grid grid-cols-2 gap-3"></div>
            </div>

            <!-- B. ูุงุฌูุฉ ุงูููู -->
            <div id="panel-tech" class="hidden fade-in">
                <!-- ุจุทุงูุฉ ุงููุญูุธุฉ -->
                <div class="bg-gradient-to-br from-gray-900 to-gray-800 text-white p-6 rounded-2xl shadow-xl relative overflow-hidden">
                    <p class="text-gray-400 text-xs font-bold">ุฑุตูุฏู ุงูุญุงูู</p>
                    <div class="flex items-end gap-2 mt-1">
                        <h2 id="tech-wallet" class="text-4xl font-black">0</h2>
                        <span class="text-sm mb-1 text-gray-400">ุฏุฑูู</span>
                    </div>
                    <div class="mt-4 flex gap-2">
                        <span class="text-[10px] bg-green-500/20 text-green-300 px-2 py-1 rounded">+ ุนูููุงุช ุงูุจูุน</span>
                        <span class="text-[10px] bg-blue-500/20 text-blue-300 px-2 py-1 rounded">+ ุฃุฌูุฑ ุงูุชุฑููุจ</span>
                    </div>
                </div>

                <!-- ุชุจููุจุงุช -->
                <div class="flex bg-white p-1 rounded-xl shadow border my-4">
                    <button onclick="app.techTab('prod')" id="tab-prod" class="flex-1 py-2 rounded-lg text-sm font-bold bg-blue-100 text-blue-900">ุดุฑุงุก ูุทุน</button>
                    <button onclick="app.techTab('req')" id="tab-req" class="flex-1 py-2 rounded-lg text-sm font-bold text-gray-500">ุทูุจุงุช ุงูุนูู</button>
                </div>

                <div id="view-tech-products" class="space-y-3"></div>
                <div id="view-tech-requests" class="hidden space-y-3"></div>
            </div>

            <!-- C. ูุงุฌูุฉ ุงูุฅุฏุงุฑุฉ -->
            <div id="panel-admin" class="hidden fade-in">
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="bg-white p-4 rounded-xl shadow text-center">
                        <h3 class="font-bold text-2xl text-blue-900" id="admin-users-count">0</h3>
                        <p class="text-xs text-gray-500">ูุดุชุฑู</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow text-center">
                        <h3 class="font-bold text-2xl text-green-600" id="admin-sales-count">0</h3>
                        <p class="text-xs text-gray-500">ูุจูุนุงุช</p>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl border">
                    <h3 class="font-bold text-sm mb-3">โ ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ</h3>
                    <input id="new-prod-name" type="text" placeholder="ุงุณู ุงูููุชุฌ" class="w-full mb-2 p-2 bg-gray-50 border rounded text-sm">
                    <div class="flex gap-2">
                        <input id="new-prod-price" type="number" placeholder="ุณุนุฑ ุงูุจูุน" class="w-full mb-2 p-2 bg-gray-50 border rounded text-sm">
                        <input id="new-prod-comm" type="number" placeholder="ุงูุนูููุฉ" class="w-full mb-2 p-2 bg-gray-50 border rounded text-sm">
                    </div>
                    <button onclick="app.addProduct()" class="w-full bg-black text-white py-2 rounded-lg text-sm font-bold">ุฅุถุงูุฉ</button>
                </div>

                <div id="list-admin-products" class="space-y-2 mt-4"></div>
            </div>

        </div>
    </div>

    <!-- ูุงูุฐุฉ ููุจุซูุฉ ูุทูุจ ุงูุฎุฏูุฉ -->
    <div id="modal-service" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-2xl p-6">
            <h3 class="font-bold text-lg mb-4 text-center">ุทูุจ ููู ุฌุฏูุฏ</h3>
            <select id="srv-type" class="w-full p-3 bg-gray-50 border rounded-xl mb-3">
                <option>ุถุจุท ุฅุดุงุฑุฉ (Parabole)</option>
                <option>ุชุฑููุจ ุชููุงุฒ</option>
                <option>ุชูุฏูุฏ ูุงุจูุงุช</option>
            </select>
            <input id="srv-addr" type="text" placeholder="ุนููุงูู ูุงููุฏููุฉ" class="w-full p-3 bg-gray-50 border rounded-xl mb-4">
            <button onclick="app.submitRequest()" class="w-full bg-purple-600 text-white py-3 rounded-xl font-bold">ุชุฃููุฏ ุงูุทูุจ</button>
            <button onclick="document.getElementById('modal-service').classList.add('hidden')" class="w-full text-gray-400 text-sm mt-3">ุฅูุบุงุก</button>
        </div>
    </div>

    <!-- ================= 3. ููุฏ ุงูุจุฑูุฌุฉ (Logic) ================= -->
    <script>
        // 1. ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช (ุชุฎุฒูู ูู ุงููุงุชู)
        const db = {
            users: JSON.parse(localStorage.getItem('sf_users')) || [],
            currentUser: JSON.parse(localStorage.getItem('sf_current_user')) || null,
            products: JSON.parse(localStorage.getItem('sf_products')) || [
                { id: 1, name: "ุฑุณููุฑ Echolink", price: 250, comm: 50 },
                { id: 2, name: "ูุงูุท LNB 4k", price: 80, comm: 20 }
            ],
            requests: JSON.parse(localStorage.getItem('sf_requests')) || [],
            
            save: function() {
                localStorage.setItem('sf_users', JSON.stringify(this.users));
                localStorage.setItem('sf_products', JSON.stringify(this.products));
                localStorage.setItem('sf_requests', JSON.stringify(this.requests));
                localStorage.setItem('sf_current_user', JSON.stringify(this.currentUser));
            }
        };

        // 2. ูุธุงู ุงููุตุงุฏูุฉ (Auth)
        const auth = {
            init: function() {
                if(db.currentUser) {
                    this.showDashboard(db.currentUser);
                }
            },

            switch: function(screen) {
                if(screen === 'register') {
                    document.getElementById('form-login').classList.add('hidden');
                    document.getElementById('form-register').classList.remove('hidden');
                } else {
                    document.getElementById('form-register').classList.add('hidden');
                    document.getElementById('form-login').classList.remove('hidden');
                }
            },

            register: function() {
                const name = document.getElementById('reg-name').value;
                const phone = document.getElementById('reg-phone').value;
                const pass = document.getElementById('reg-pass').value;
                const role = document.querySelector('input[name="role"]:checked').value;

                if(!name || !phone || !pass) return alert("ุงููุฑุฌู ููุก ุฌููุน ุงูุจูุงูุงุช");

                // ุงูุชุญูู ูู ุงููุงุชู ูุณุฌู ุณุงุจูุงู
                if(db.users.find(u => u.phone === phone)) return alert("ุฑูู ุงููุงุชู ูุณุฌู ูุณุจูุงู!");

                const newUser = { 
                    id: Date.now(), 
                    name, phone, pass, role, 
                    wallet: 0 // ููููููู ููุท
                };

                db.users.push(newUser);
                db.currentUser = newUser;
                db.save();

                alert("โ ุชู ุฅูุดุงุก ุงูุญุณุงุจ ุจูุฌุงุญ!");
                this.showDashboard(newUser);
            },

            login: function() {
                const phone = document.getElementById('login-phone').value;
                const pass = document.getElementById('login-pass').value;

                const user = db.users.find(u => u.phone === phone && u.pass === pass);

                if(user) {
                    db.currentUser = user;
                    db.save();
                    this.showDashboard(user);
                } else {
                    alert("โ ุฑูู ุงููุงุชู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ");
                }
            },

            quickAdmin: function() {
                const adminUser = { name: "ุงููุฏูุฑ", role: "admin" };
                db.currentUser = adminUser;
                db.save();
                this.showDashboard(adminUser);
            },

            logout: function() {
                db.currentUser = null;
                db.save();
                location.reload();
            },

            showDashboard: function(user) {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('welcome-msg').innerText = `ูุฑุญุจุงูุ ${user.name} (${user.role === 'tech' ? 'ููู' : user.role === 'client' ? 'ุฒุจูู' : 'ูุฏูุฑ'})`;

                // ุชูุฌูู ูููุญุฉ ุงูููุงุณุจุฉ
                if(user.role === 'client') app.renderClient();
                if(user.role === 'tech') app.renderTech();
                if(user.role === 'admin') app.renderAdmin();
            }
        };

        // 3. ููุทู ุงูุชุทุจูู (App Logic)
        const app = {
            renderClient: function() {
                document.getElementById('panel-client').classList.remove('hidden');
                const container = document.getElementById('list-client-products');
                container.innerHTML = db.products.map(p => `
                    <div class="bg-white p-3 rounded-xl border text-center shadow-sm">
                        <div class="bg-gray-100 h-20 rounded mb-2 flex items-center justify-center text-3xl">๐ฆ</div>
                        <h4 class="font-bold text-sm">${p.name}</h4>
                        <p class="text-blue-600 font-bold">${p.price} ุฏุฑูู</p>
                        <button class="w-full mt-2 bg-blue-50 text-blue-700 text-xs py-2 rounded font-bold">ุดุฑุงุก</button>
                    </div>
                `).join('');
            },

            submitRequest: function() {
                const type = document.getElementById('srv-type').value;
                const addr = document.getElementById('srv-addr').value;
                if(!addr) return alert("ุงููุฑุฌู ูุชุงุจุฉ ุงูุนููุงู");

                db.requests.push({
                    id: Date.now(),
                    client: db.currentUser.name,
                    phone: db.currentUser.phone,
                    type, addr, status: 'pending'
                });
                db.save();
                document.getElementById('modal-service').classList.add('hidden');
                alert("โ ุชู ุฅุฑุณุงู ุงูุทูุจ ููููููู!");
            },

            renderTech: function() {
                document.getElementById('panel-tech').classList.remove('hidden');
                document.getElementById('tech-wallet').innerText = db.currentUser.wallet;

                // ููุชุฌุงุช ุงูููู
                document.getElementById('view-tech-products').innerHTML = db.products.map(p => `
                    <div class="bg-white p-4 rounded-xl shadow-sm border flex justify-between items-center">
                        <div>
                            <h4 class="font-bold">${p.name}</h4>
                            <span class="text-xs text-gray-500">ุณุนุฑ ุงูุจูุน: ${p.price}</span>
                        </div>
                        <button onclick="app.techBuy(${p.id})" class="bg-blue-900 text-white px-4 py-2 rounded-lg text-xs font-bold shadow">
                            ุดุฑุงุก (+${p.comm} ุฏุฑูู)
                        </button>
                    </div>
                `).join('');

                // ุทูุจุงุช ุงูููู
                const reqList = document.getElementById('view-tech-requests');
                const pending = db.requests.filter(r => r.status === 'pending');
                if(pending.length === 0) {
                    reqList.innerHTML = '<p class="text-center text-gray-400 py-4">ูุง ุชูุฌุฏ ุทูุจุงุช ุฌุฏูุฏุฉ</p>';
                } else {
                    reqList.innerHTML = pending.map(r => `
                        <div class="bg-white border-r-4 border-yellow-400 p-4 rounded shadow-sm">
                            <h4 class="font-bold">${r.type}</h4>
                            <p class="text-sm text-gray-600">๐ ${r.addr}</p>
                            <p class="text-xs text-gray-400">ุงูุฒุจูู: ${r.client}</p>
                            <button onclick="app.acceptReq(${r.id})" class="w-full mt-2 bg-gray-800 text-white py-2 rounded text-xs">ูุจูู</button>
                        </div>
                    `).join('');
                }
            },

            techTab: function(tab) {
                if(tab === 'prod') {
                    document.getElementById('view-tech-products').classList.remove('hidden');
                    document.getElementById('view-tech-requests').classList.add('hidden');
                    document.getElementById('tab-prod').className = "flex-1 py-2 rounded-lg text-sm font-bold bg-blue-100 text-blue-900";
                    document.getElementById('tab-req').className = "flex-1 py-2 rounded-lg text-sm font-bold text-gray-500";
                } else {
                    document.getElementById('view-tech-products').classList.add('hidden');
                    document.getElementById('view-tech-requests').classList.remove('hidden');
                    document.getElementById('tab-prod').className = "flex-1 py-2 rounded-lg text-sm font-bold text-gray-500";
                    document.getElementById('tab-req').className = "flex-1 py-2 rounded-lg text-sm font-bold bg-blue-100 text-blue-900";
                }
            },

            techBuy: function(id) {
                const prod = db.products.find(p => p.id === id);
                if(confirm(`ุชุฃููุฏ ุนูููุฉ ุงูุดุฑุงุกุ`)) {
                    db.currentUser.wallet += parseInt(prod.comm);
                    // ุชุญุฏูุซ ุงููุณุชุฎุฏู ูู ุงููุตูููุฉ ุงูุฑุฆูุณูุฉ ุฃูุถุงู
                    const idx = db.users.findIndex(u => u.id === db.currentUser.id);
                    if(idx !== -1) db.users[idx].wallet = db.currentUser.wallet;
                    
                    db.save();
                    this.renderTech();
                    alert("๐ฐ ุชูุช ุฅุถุงูุฉ ุงูุนูููุฉ!");
                }
            },

            acceptReq: function(id) {
                const r = db.requests.find(x => x.id === id);
                r.status = 'accepted';
                db.save();
                this.renderTech();
                alert(`โ ุชู ูุจูู ุงูุทูุจ.\nุฑูู ุงูุฒุจูู: ${r.phone}`);
            },

            renderAdmin: function() {
                document.getElementById('panel-admin').classList.remove('hidden');
                document.getElementById('admin-users-count').innerText = db.users.length;
                
                document.getElementById('list-admin-products').innerHTML = db.products.map(p => `
                    <div class="flex justify-between p-3 bg-gray-50 rounded border text-sm">
                        <span>${p.name} (${p.price} ุฏ.ู)</span>
                        <span class="text-red-500 cursor-pointer" onclick="app.delProd(${p.id})">ุญุฐู</span>
                    </div>
                `).join('');
            },

            addProduct: function() {
                const name = document.getElementById('new-prod-name').value;
                const price = document.getElementById('new-prod-price').value;
                const comm = document.getElementById('new-prod-comm').value;
                if(!name) return;
                db.products.push({ id: Date.now(), name, price, comm });
                db.save();
                this.renderAdmin();
                document.getElementById('new-prod-name').value = '';
            },

            delProd: function(id) {
                if(confirm('ุญุฐูุ')) {
                    db.products = db.products.filter(p => p.id !== id);
                    db.save();
                    this.renderAdmin();
                }
            }
        };

        // ุชุดุบูู ุงูุชุญูู ุนูุฏ ุจุฏุก ุงูุชุทุจูู
        auth.init();

    </script>
</body>
</html>