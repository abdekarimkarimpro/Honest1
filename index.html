// --- 0.5. Language Data & Management ---

const translations = {
    'ar': {
        'app_title': 'Honest Sat',
        'login_title': 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
        'phone_placeholder': 'Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ',
        'password_placeholder': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
        'login_button': 'Ø¯Ø®ÙˆÙ„',
        'no_account': 'Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ',
        'create_account_button': 'âœ¨ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯',
        'back_to_login': 'ðŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
        'name_placeholder': 'Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„',
        'register_title': 'Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯',
        'register_button': 'ØªØ³Ø¬ÙŠÙ„',
        'role_client': 'ðŸ‘¤ Ø¹Ù…ÙŠÙ„',
        'role_tech': 'ðŸ”§ ÙÙ†ÙŠ',
        'register_as': 'Ø£Ø±ØºØ¨ Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙƒÙ€:',
        'logout_button': 'ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬',
        'client_shop_tab': 'ðŸ›’ ØªØ³ÙˆÙ‚ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
        'client_req_tab': 'ðŸ“œ Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©',
        'maintenance_title': 'Ø®Ø¯Ù…Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©',
        'maintenance_text': 'Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø¹Ø·Ù„ØŸ Ø§Ø·Ù„Ø¨ ÙÙ†ÙŠØ§Ù‹ Ø§Ù„Ø¢Ù†.',
        'request_service_button': 'Ø·Ù„Ø¨ Ø®Ø¯Ù…Ø©',
        'available_products': 'â­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©',
        'request_history': 'Ø³Ø¬Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©',
        'tech_balance': 'Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­',
        'tech_withdraw': 'ðŸ’¸ Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­',
        'tech_buy_prod': 'Ø´Ø±Ø§Ø¡ Ù…Ù†ØªØ¬Ø§Øª',
        'tech_work_req': 'Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ù…Ù„',
        'tech_earnings_log': 'Ø³Ø¬Ù„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­',
        'new_request_title': 'Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯',
        'service_phone': 'Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø§ØªØµØ§Ù„',
        'service_addr': 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ÙØµÙ„',
        'confirm_request': 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨',
        'cancel_button': 'Ø¥Ù„ØºØ§Ø¡',
        'status_pending': 'Ù…Ø¹Ù„Ù‘ÙŽÙ‚',
        'status_accepted': 'Ù…Ù‚Ø¨ÙˆÙ„ (Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°)',
        'status_completed': 'Ù…ÙƒØªÙ…Ù„',
        'accept_job': 'Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©',
        'job_completed': 'âœ… Ø§Ù„Ù…Ù‡Ù…Ø© Ø§ÙƒØªÙ…Ù„Øª',
        'contact_client': 'ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„:',
        'admin_panel_title': 'Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±',
        'admin_pending_users': 'ðŸ†• Ø·Ù„Ø¨Ø§Øª ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª',
        'admin_all_users': 'ðŸ‘¥ Ø³Ø¬Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',
        'admin_manage_prods': 'âž• Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
        'admin_prod_name': 'Ø§Ù„Ø§Ø³Ù…',
        'admin_prod_price': 'Ø³Ø¹Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„',
        'admin_prod_comm': 'Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„ÙÙ†ÙŠ',
        'admin_prod_image_file': 'ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬',
        'admin_prod_image_url': 'Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±',
        'admin_add_prod': 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬',
        'admin_current_prods': 'ðŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©',
        'admin_all_requests': 'ðŸ“œ Ø³Ø¬Ù„ Ø¬Ù…ÙŠØ¹ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©',
        'approve_button': 'Ù‚Ø¨ÙˆÙ„',
        'reject_button': 'Ø±ÙØ¶',
        'delete_button': 'Ø­Ø°Ù',
        'admin_delete_user': 'Ø­Ø°Ù',
        'admin_client_role': 'Ø¹Ù…ÙŠÙ„ ðŸ‘¤',
        'admin_tech_role': 'ÙÙ†ÙŠ ðŸ”§',
        'admin_approved': 'âœ… Ù…Ù‚Ø¨ÙˆÙ„',
        'admin_pending': 'âŒ Ù…Ø¹Ù„Ù‘ÙŽÙ‚',
    },
    'fr': {
        'app_title': 'Honest Sat',
        'login_title': 'Connexion',
        'phone_placeholder': 'NumÃ©ro de TÃ©lÃ©phone',
        'password_placeholder': 'Mot de passe',
        'login_button': 'Se Connecter',
        'no_account': 'Pas de compte?',
        'create_account_button': 'âœ¨ CrÃ©er un nouveau compte',
        'back_to_login': 'ðŸ”™ Retour Ã  la Connexion',
        'name_placeholder': 'Nom Complet',
        'register_title': 'Nouveau Compte',
        'register_button': 'S\'inscrire',
        'role_client': 'ðŸ‘¤ Client',
        'role_tech': 'ðŸ”§ Technicien',
        'register_as': 'Je veux m\'inscrire en tant que:',
        'logout_button': 'DÃ©connexion',
        'client_shop_tab': 'ðŸ›’ Acheter des Produits',
        'client_req_tab': 'ðŸ“œ Mes Demandes',
        'maintenance_title': 'Service de Maintenance',
        'maintenance_text': 'Un problÃ¨me? Demandez un technicien maintenant.',
        'request_service_button': 'Demander un Service',
        'available_products': 'â­ Produits Disponibles',
        'request_history': 'Historique des demandes de maintenance',
        'tech_balance': 'Solde Disponible',
        'tech_withdraw': 'ðŸ’¸ Retirer les gains',
        'tech_buy_prod': 'Acheter Produits',
        'tech_work_req': 'Demandes de Travail',
        'tech_earnings_log': 'Journal des Gains',
        'new_request_title': 'Nouvelle Demande',
        'service_phone': 'NumÃ©ro de TÃ©lÃ©phone Contact',
        'service_addr': 'Adresse DÃ©taillÃ©e',
        'confirm_request': 'Confirmer la Demande',
        'cancel_button': 'Annuler',
        'status_pending': 'En Attente',
        'status_accepted': 'AcceptÃ©e (En Cours)',
        'status_completed': 'TerminÃ©e',
        'accept_job': 'Accepter le Travail',
        'job_completed': 'âœ… Travail TerminÃ©',
        'contact_client': 'Contacter le Client:',
        'admin_panel_title': 'Panneau d\'Administration',
        'admin_pending_users': 'ðŸ†• Demandes d\'Activation de Compte',
        'admin_all_users': 'ðŸ‘¥ Journal de Tous les Utilisateurs',
        'admin_manage_prods': 'âž• GÃ©rer les Produits',
        'admin_prod_name': 'Nom',
        'admin_prod_price': 'Prix Client',
        'admin_prod_comm': 'Commission Technicien',
        'admin_prod_image_file': 'Image du Produit',
        'admin_prod_image_url': 'Ou entrez l\'URL de l\'image directe',
        'admin_add_prod': 'Ajouter Produit',
        'admin_current_prods': 'ðŸ“¦ Produits Actuels',
        'admin_all_requests': 'ðŸ“œ Journal de Toutes les Demandes',
        'approve_button': 'Approuver',
        'reject_button': 'Rejeter',
        'delete_button': 'Supprimer',
        'admin_delete_user': 'Supprimer',
        'admin_client_role': 'Client ðŸ‘¤',
        'admin_tech_role': 'Technicien ðŸ”§',
        'admin_approved': 'âœ… ApprouvÃ©',
        'admin_pending': 'âŒ En Attente',
    },
    'en': {
        // ... (Keep existing English texts, or define them explicitly if needed)
        'app_title': 'Honest Sat',
        'login_title': 'Login',
        'phone_placeholder': 'Phone Number',
        'password_placeholder': 'Password',
        'login_button': 'Login',
        'no_account': "Don't have an account?",
        'create_account_button': 'âœ¨ Create New Account',
        'back_to_login': 'ðŸ”™ Back to Login',
        'name_placeholder': 'Full Name',
        'register_title': 'New Account',
        'register_button': 'Register',
        'role_client': 'ðŸ‘¤ Client',
        'role_tech': 'ðŸ”§ Technician',
        'register_as': 'I want to register as:',
        'logout_button': 'Logout',
        'client_shop_tab': 'ðŸ›’ Shop Products',
        'client_req_tab': 'ðŸ“œ My Past Requests',
        'maintenance_title': 'Maintenance Service',
        'maintenance_text': 'Got a fault? Request a technician now.',
        'request_service_button': 'Request Service',
        'available_products': 'â­ Available Products',
        'request_history': 'Maintenance Request History',
        'tech_balance': 'Available Balance',
        'tech_withdraw': 'ðŸ’¸ Withdraw Earnings',
        'tech_buy_prod': 'Buy Products',
        'tech_work_req': 'Work Requests',
        'tech_earnings_log': 'Earnings Log',
        'new_request_title': 'New Request',
        'service_phone': 'Contact Phone Number',
        'service_addr': 'Detailed Address',
        'confirm_request': 'Confirm Request',
        'cancel_button': 'Cancel',
        'status_pending': 'Pending',
        'status_accepted': 'Accepted (In Progress)',
        'status_completed': 'Completed',
        'accept_job': 'Accept Job',
        'job_completed': 'âœ… Job Completed',
        'contact_client': 'Contact Client:',
        'admin_panel_title': 'Admin Panel',
        'admin_pending_users': 'ðŸ†• Account Activation Requests',
        'admin_all_users': 'ðŸ‘¥ All Users Log',
        'admin_manage_prods': 'âž• Manage Products',
        'admin_prod_name': 'Name',
        'admin_prod_price': 'Price for Client',
        'admin_prod_comm': 'Technician Commission',
        'admin_prod_image_file': 'Product Image',
        'admin_prod_image_url': 'Or enter direct image URL',
        'admin_add_prod': 'Add Product',
        'admin_current_prods': 'ðŸ“¦ Current Products',
        'admin_all_requests': 'ðŸ“œ All Maintenance Requests Log',
        'approve_button': 'Approve',
        'reject_button': 'Reject',
        'delete_button': 'Delete',
        'admin_delete_user': 'Delete',
        'admin_client_role': 'Client ðŸ‘¤',
        'admin_tech_role': 'Technician ðŸ”§',
        'admin_approved': 'âœ… Approved',
        'admin_pending': 'âŒ Pending',
    }
};

let currentLang = getSafeData('app_lang_v1', 'ar'); // Default to Arabic

function setLang(lang) {
    currentLang = lang;
    localStorage.setItem('app_lang_v1', JSON.stringify(lang));
    updateUI(lang); // Update all visible texts
    // Ensure the application state (like the current panel) is re-rendered to apply new texts
    if(db.current) {
        loadApp();
    } else {
        // If not logged in, just update the auth container
        document.getElementById('view-login').classList.remove('d-none'); // Force rendering of login view
        document.getElementById('view-register').classList.add('d-none');
    }
}

function t(key) {
    return translations[currentLang][key] || translations['en'][key] || `[${key}]`;
}

// Function to handle global text updates
function updateUI(lang) {
    // 1. Update text direction
    document.documentElement.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');
    
    // 2. Update meta tags (Title)
    document.title = t('app_title') + ' | Stable Version';

    // 3. Update all elements with data-i18n attributes
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.innerText = t(key);
    });

    // 4. Update all elements with data-i18n-placeholder attributes
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        el.setAttribute('placeholder', t(key));
    });
}
